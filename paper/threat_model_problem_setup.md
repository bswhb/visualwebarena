# 3. 威胁模型与问题定义（Threat Model & Problem Setup）

## 3.1 研究范围与信任边界（Scope & Trust Boundary）

- **环境**：标准桌面网页（Chrome/Chromium 内核），支持滚动、点击、输入、悬停等交互，存在异步加载与响应式布局。  
- **可用观测**：同一时刻的三类观测：  
  1. **视觉截图**：\(X_t \in \mathbb{R}^{H\times W\times 3}\)  
  2. **DOM/可访问性树**：\(G_t=(V_t,E_t)\)，每个节点含文本属性 \(\text{text}(v)\) 与渲染几何 \(\text{bbox}(v)\)  
  3. **OCR 结果集**：\(R_t=\{(b_i,\,\text{text}_i)\}\)  
- **信任边界**：浏览器与自动化框架（如 Playwright/Selenium）被视为可信；网页内容及其脚本**不可信**。  
- **非目标**：不解决验证码破解、账户登录后的业务权限问题，也不假设后端可控。

## 3.2 对手建模（Adversary Model）

我们考虑面向网页智能体的**界面级对抗者**，其目标是在关键时刻诱导智能体**误触/误操作**或令其**任务失败**，同时保持对人类用户“看似正常”。

### 能力（Capabilities）

对手可对页面做**前端层面的可见/半可见扰动**，包括但不限于：

1. **布局与几何扰动 \((T_{\text{layout}})\)**：容器平移/缩放、列数变化、CSS 类名随机化、虚拟列表重排。  
2. **遮挡与覆盖 \((T_{\text{overlay}})\)**：半透明层、同层 z-index 提升、点击穿透/阻断、伪装的“确认/取消”控件。  
3. **文本错配/同形字攻击 \((T_{\text{homo}})\)**：在视觉与 DOM 之间制造语义不一致（拉丁/Cyrillic 同形、零宽字符、大小写/空白混淆）。  
4. **隐藏与点击劫持 \((T_{\text{hidden}})\)**：`visibility/opacity/pointer-events`、伪元素、Shadow DOM/iframe 边界制造命名/定位干扰。  
5. **时序与懒加载 \((T_{\text{timing}})\)**：延迟插入真实/诱饵元素、骨架屏遮挡关键词、在滚动后切换节点位置。

### 认知（Knowledge）

- **灰盒**（默认）：对手了解智能体常用的定位与对齐手段，但**未知**我们的一致性阈值与具体权重。  
- **黑盒/白盒**（用于鲁棒性上界/下界分析）：分别不知/完全知晓防御细节。

### 预算与隐蔽性（Budget & Stealth）

通过扰动强度 \(s\in[0,1]\) 控制对手预算：强度越大，对用户体验破坏越明显。实验中以 \(s\) 分层生成“轻度/中度/重度”配置，并绘制退化曲线。

### 目标（Adversary Goals）

- **ASR↑**：诱导智能体在关键动作上**误触**或选择**错误目标**。  
- **SR↓**：降低任务成功率。  
- **Stealth↑**：在给定 \(s\) 下使人类不易察觉异常。

## 3.3 防守者与代理（Defender & Agent）

- **被防护的基础代理** \(\pi_0\)：可执行网页任务，采用常规感知/工具调用策略（如文本-视觉定位 + DOM 操作）。  
- **我们的防御层** \(g\)：在 \(\pi_0\) 即将执行动作 \(a_t\) 前，对其目标区域进行**三视图一致性检验**与**级联复核**，决定执行/复核/拒绝/降级。  
- **关键动作集** \(\mathcal{A}_{\text{crit}}\)：如“支付/删除/提交/确认购买”等，对其应用更高门限与更强复核链。

## 3.4 形式化表述（Formalization）

### 状态与观测

- 页面状态 \(S_t\) 通过观测 \(O_t=(X_t,G_t,R_t)\) 部分可见；候选交互目标来自 DOM 集合 \(D_t\subseteq V_t\)。  
- 对于每个候选 \(d\in D_t\)，定义与其位置相交的视觉候选集 \(V(d)\) 与 OCR 候选集 \(R(d)\)。

### 三视图匹配与一致性分数

对候选三元组 \((v,d,r)\)，定义：

- 位置一致性：
  \[
  C_p=\tfrac{1}{2}\text{IoU}(b_v,b_d)+\tfrac{1}{2}\text{IoU}(b_v,b_r),
  \]
- 文本一致性：
  \[
  C_t=\text{sim}\big(\text{text}(d),\,\text{text}(r)\big),
  \]
- 样式/图标一致性 \(C_s\)（可选，基于形状/图标 embedding）。

归一化一致性分数：
\[
S(v,d,r)=w_p C_p+w_t C_t+w_s C_s\in[0,1].
\]

面向动作目标 \(d^\*\) 的最大一致性：
\[
S^\*(d^\*)=\max_{v\in V(d^\*),\,r\in R(d^\*)}S(v,d^\*,r).
\]

### 决策规则（Hypothesis Test / Gating）

- **原假设** \(H_0\)：三视图对齐、一致。  
- **备择假设** \(H_1\)：存在不一致/欺骗。

对一般动作使用阈值 \(\tau_{\text{low}}\)，对关键动作使用更高阈值 \(\tau_{\text{high}}\)：

- 若 \(S^\*(d^\*)\ge \tau\)，**执行（Execute）**；  
- 若 \(\tau'\le S^\*(d^\*)<\tau\)，进入**复核（Review）**；  
- 若 \(S^\*(d^\*)<\tau'\)，**拒绝（Reject）**，可降级为“请求人工确认”等安全策略。

**级联复核**：当进入 Review，触发高分辨率裁剪 OCR、可访问性树（A11y）名称比对、以及时序再取样；得到精炼分数 \(\tilde S\) 后再次判定。

### 目标函数（Defender Objective）

在扰动强度分布 \(p(s)\) 下，最小化**期望风险**：
\[
\mathcal{R}=\mathbb{E}_{s\sim p(s)}\big[
\lambda_1 \underbrace{\mathbf{1}[\text{misoperation}]}_{\text{FN}}
+\lambda_2 \underbrace{\mathbf{1}[\text{unnecessary reject}]}_{\text{FP}}
+\lambda_3 \underbrace{(\text{latency}+\text{token\_cost})}_{\text{overhead}}
\big],
\]
并约束关键动作的**误触率**：
\[
\Pr(\text{misoperation}\mid a\in\mathcal{A}_{\text{crit}})\le \epsilon.
\]

可以学习 \((w_p,w_t,w_s,\tau,\tau')\) 或在验证集上调参。

## 3.5 误操作与成功的判定（Outcomes）

- **任务成功率（SR）**：在最大步骤上限内完成任务的比例。  
- **误操作率（MOR）**：执行与目标元素/语义不一致的关键动作的比例。  
- **对抗成功率（ASR）**：在启用防御下，攻击仍导致误操作或任务失败的比例。  
- **成本与时延**：平均推理时长、工具调用次数、LLM token 成本。

## 3.6 边界条件与棘手案例（Edge Cases）

- **Canvas/图像化文本**：DOM 无语义但视觉有文字；需要依赖 OCR 与 A11y 互证。  
- **Shadow DOM/跨域 iframe**：几何映射存在偏差；在级联复核中进行坐标归一与跨源可见性判定。  
- **虚拟列表/延迟渲染**：同一 DOM 节点的 \(\text{bbox}\) 在时序上漂移；需要二次采样以获得稳定观测。  
- **与人类可用性冲突**：强扰动下，即便人类也需要额外确认；此类情况记作“必要拒绝”，计入 FP 但在讨论中单独分析。
